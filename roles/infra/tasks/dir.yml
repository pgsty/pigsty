---
#--------------------------------------------------------------#
# Infra Directories                                  [infra_dir]
#--------------------------------------------------------------#
# Create all infra directories with proper ownership and permissions
# FHS:
# /infra -> /data/infra    # soft link for convenience
# /data/infra/             # infra data root
#  ^--- metrics/           # VictoriaMetrics data
#  ^--- logs/              # VictoriaLogs data
#  ^--- traces/            # VictoriaTraces data
#  ^--- alertmgr/          # AlertManager data
#
#  ^--- prometheus.yml     # VictoriaMetrics config
#  ^--- targets/           # FileSD targets
#  ^--- rules/             # Alert and recording rules
#  ^--- bin/               # Utility scripts
#
#  ^--- dashboards/        # Grafana dashboards definitions
#  ^--- datasources/       # Grafana datasource definitions
#--------------------------------------------------------------#


#--------------------------------------------------------------#

#--------------------------------------------------------------#
# Create infra data directories                 [infra_dir_data]
#--------------------------------------------------------------#
# main data directory owned by victoria
- name: create infra data directories
  tags: [ infra_dir, infra_dir_data ]
  file: path={{ infra_data }} state=directory owner=root group=infra mode='0770'

#--------------------------------------------------------------#
# Create infra data directories                 [infra_dir_link]
#--------------------------------------------------------------#
- name: create infra soft link
  tags: [ infra_dir, infra_dir_link ]
  file: src=/data/infra dest=/infra state=link

#--------------------------------------------------------------#
# Create infra data directories               [infra_dir_create]
#--------------------------------------------------------------#
- name: create infra data directories
  tags: [ infra_dir, infra_dir_create ]
  file: path={{ item.path }} state={{ item.state|default('directory') }} owner={{ item.owner|default(root) }} group={{ item.group|default('infra') }} mode={{ item.mode|default('0750') }}
  with_items:
    - { path: /infra/conf        ,owner: root              ,mode: '0750' }
    - { path: /infra/pgadmin     ,owner: 5050 ,group: 5050 ,mode: '0700' }
    - { path: /infra/alertmgr    ,owner: prometheus        ,mode: '0700' }
    - { path: /infra/dashboards  ,owner: victoria          ,mode: '0750' }
    - { path: /infra/datasources ,owner: root              ,mode: '0700' }

...
